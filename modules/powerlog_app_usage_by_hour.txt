[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Application usage by hour

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=IOS
VERSIONS=9,10,11,12,13

[Query Metadata]
QUERY_NAME=powerlog_app_usage_by_hour
ACTIVITY=App Usage by Hour
KEY_TIMESTAMP=HOUR OF DAY

[SQL Query 10,11,12,13]
QUERY=
	SELECT
		DATETIME(APPUSAGE_TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS "HOUR OF DAY",
		TIMEINTERVAL / 60 AS "TIME INTERVAL (MINUTES)",
		BUNDLEID AS "BUNDLE ID",
		SCREENONTIME AS "SCREEN TIME (SECONDS)",
		BACKGROUNDTIME AS "BACKGROUND TIME (SECONDS)",
		BACKGROUNDAUDIONOWPLAYINGTIME AS "BACKGROUND AUDIO NOW PLAYING TIME (SECONDS)",
		BACKGROUNDLOCATIONTIME AS "BACKGROUND LOCATION TIME (SECONDS)",
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		APPUSAGE_ID AS "PLAPPTIMESERVICE_AGGREGATE_APPRUNTIME TABLE ID" 
	FROM
	(
		SELECT
			APPUSAGE_ID,
			APPUSAGE_TIMESTAMP,
			TIME_OFFSET_TIMESTAMP,
			MAX(TIME_OFFSET_ID) AS MAX_ID,
			TIMEINTERVAL,
			BUNDLEID,
			SCREENONTIME,
			BACKGROUNDTIME,
			BACKGROUNDAUDIONOWPLAYINGTIME,
			BACKGROUNDLOCATIONTIME,
			SYSTEM
		FROM
		(
			SELECT
				PLAPPTIMESERVICE_AGGREGATE_APPRUNTIME.TIMESTAMP AS APPUSAGE_TIMESTAMP,
				TIMEINTERVAL,
				BUNDLEID,
				SCREENONTIME,
				BACKGROUNDTIME,
				BACKGROUNDAUDIONOWPLAYINGTIME,
				BACKGROUNDLOCATIONTIME,
				PLAPPTIMESERVICE_AGGREGATE_APPRUNTIME.ID AS "APPUSAGE_ID" ,
				PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
				PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
				PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
			FROM
				PLAPPTIMESERVICE_AGGREGATE_APPRUNTIME
			LEFT JOIN
				PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
			)
			AS APPUSAGE_STATE 
			GROUP BY
				APPUSAGE_ID 
			)

[SQL Query 9]
QUERY=
   	SELECT
	   DATETIME(TIMESTAMP, 'UNIXEPOCH') AS "HOUR OF DAY",
	   TIMEINTERVAL / 60 AS "TIME INTERVAL (MINUTES)",
	   BUNDLEID AS "BUNDLE ID",
	   SCREENONTIME AS "SCREEN TIME (SECONDS)",
	   BACKGROUNDTIME AS "BACKGROUND TIME (SECONDS)",
	   ID AS "PLAPPTIMESERVICE_AGGREGATE_APPRUNTIME TABLE ID" 
	FROM
	   PLAPPTIMESERVICE_AGGREGATE_APPRUNTIME
