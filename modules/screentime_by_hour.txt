[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Screen Time - Generic (By Hour)

[Database Metadata]
DATABASE=RMAdminStore-Local.sqlite,RMAdminStore-Cloud.sqlite
PLATFORM=IOS,MACOS
VERSIONS=12,13,10.15

[Query Metadata]
QUERY_NAME=screentime_by_hour
ACTIVITY=Screen Time - Generic (By Hour)
KEY_TIMESTAMP=HOUR

[SQL Query 13,10.15]
QUERY=
	SELECT
		DISTINCT
		DATETIME(ZUSAGEBLOCK.ZSTARTDATE+978307200,'UNIXEPOCH') AS 'HOUR',
		ZUSAGEBLOCK.ZSCREENTIMEINSECONDS AS 'SCREENTIME (SECONDS)',
		ZUSAGEBLOCK.ZSCREENTIMEINSECONDS/60.00 AS 'SCREENTIME (MINUTES)',	
		ZCOREUSER.ZGIVENNAME AS 'GIVEN NAME',
		ZCOREUSER.ZFAMILYNAME AS 'FAMILY NAME',
		ZCOREDEVICE.ZNAME AS 'NAME',
		CASE ZCOREDEVICE.ZPLATFORM
			WHEN 0 THEN 'Unknown'
			WHEN 1 THEN 'macOS'
			WHEN 2 THEN 'iOS'
			WHEN 4 THEN 'Apple Watch'
			ELSE ZPLATFORM
		END AS PLATFORM,
		ZCOREDEVICE.ZIDENTIFIER AS 'DEVICE ID',
		ZCOREDEVICE.ZLOCALUSERDEVICESTATE AS 'LOCAL USER DEVICE STATE',
		DATETIME(ZUSAGEBLOCK.ZLONGESTSESSIONSTARTDATE+978307200,'UNIXEPOCH') AS 'LONGEST SESSION START',
		DATETIME(ZUSAGEBLOCK.ZLONGESTSESSIONENDDATE+978307200,'UNIXEPOCH') AS 'LONGEST SESSION END',
		DATETIME(ZUSAGEBLOCK.ZLASTEVENTDATE+978307200,'UNIXEPOCH') AS 'LAST EVENT DATE',
		(ZLONGESTSESSIONENDDATE-ZLONGESTSESSIONSTARTDATE) AS 'LONGEST SESSION TIME (SECONDS)',
		(ZLONGESTSESSIONENDDATE-ZLONGESTSESSIONSTARTDATE)/60.00 AS 'LONGEST SESSION TIME (MINUTES)',
		ZCOREUSER.ZFAMILYMEMBERTYPE AS 'FAMILY MEMBER TYPE',
		ZCOREUSER.ZAPPLEID AS 'APPLE ID',
		ZCOREUSER.ZDSID AS 'DSID',
		ZCOREUSER.ZALTDSID AS 'ALT DSID'
	FROM ZUSAGETIMEDITEM
	LEFT JOIN ZUSAGECATEGORY ON ZUSAGECATEGORY.Z_PK == ZUSAGETIMEDITEM.ZCATEGORY
	LEFT JOIN ZUSAGEBLOCK ON ZUSAGECATEGORY.ZBLOCK == ZUSAGEBLOCK.Z_PK
	LEFT JOIN ZUSAGE ON ZUSAGEBLOCK.ZUSAGE == ZUSAGE.Z_PK
	LEFT JOIN ZCOREUSER ON ZUSAGE.ZUSER == ZCOREUSER.Z_PK
	LEFT JOIN ZCOREDEVICE ON ZUSAGE.ZDEVICE == ZCOREDEVICE.Z_PK

[SQL Query 12]	
QUERY=
	SELECT
		DISTINCT
		DATETIME(ZUSAGEBLOCK.ZSTARTDATE+978307200,'UNIXEPOCH') AS 'HOUR',
		ZUSAGEBLOCK.ZSCREENTIMEINSECONDS AS 'SCREENTIME (SECONDS)',
		ZUSAGEBLOCK.ZSCREENTIMEINSECONDS/60.00 AS 'SCREENTIME (MINUTES)',	
		ZCOREUSER.ZGIVENNAME AS 'GIVEN NAME',
		ZCOREUSER.ZFAMILYNAME AS 'FAMILY NAME',
		ZCOREDEVICE.ZNAME AS 'NAME',
		ZCOREDEVICE.ZIDENTIFIER AS 'DEVICE ID',
		ZCOREDEVICE.ZLOCALUSERDEVICESTATE AS 'LOCAL USER DEVICE STATE',
		DATETIME(ZUSAGEBLOCK.ZLONGESTSESSIONSTARTDATE+978307200,'UNIXEPOCH') AS 'LONGEST SESSION START',
		DATETIME(ZUSAGEBLOCK.ZLONGESTSESSIONENDDATE+978307200,'UNIXEPOCH') AS 'LONGEST SESSION END',
		DATETIME(ZUSAGEBLOCK.ZLASTEVENTDATE+978307200,'UNIXEPOCH') AS 'LAST EVENT DATE',
		(ZLONGESTSESSIONENDDATE-ZLONGESTSESSIONSTARTDATE) AS 'LONGEST SESSION TIME (SECONDS)',
		(ZLONGESTSESSIONENDDATE-ZLONGESTSESSIONSTARTDATE)/60.00 AS 'LONGEST SESSION TIME (MINUTES)',
		ZCOREUSER.ZFAMILYMEMBERTYPE AS 'FAMILY MEMBER TYPE',
		ZCOREUSER.ZAPPLEID AS 'APPLE ID',
		ZCOREUSER.ZDSID AS 'DSID'
	FROM ZUSAGETIMEDITEM
	LEFT JOIN ZUSAGECATEGORY ON ZUSAGECATEGORY.Z_PK == ZUSAGETIMEDITEM.ZCATEGORY
	LEFT JOIN ZUSAGEBLOCK ON ZUSAGECATEGORY.ZBLOCK == ZUSAGEBLOCK.Z_PK
	LEFT JOIN ZUSAGE ON ZUSAGEBLOCK.ZUSAGE == ZUSAGE.Z_PK
	LEFT JOIN ZCOREUSER ON ZUSAGE.ZUSER == ZCOREUSER.Z_PK
	LEFT JOIN ZCOREDEVICE ON ZUSAGE.ZDEVICE == ZCOREDEVICE.Z_PK
	
