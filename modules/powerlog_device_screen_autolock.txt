[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Records the Auto-Lock timestamp. 

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=IOS
VERSIONS=9,10,11,12,13

[Query Metadata]
QUERY_NAME=powerlog_device_screen_autolock
ACTIVITY=Screen Unlock State
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 9,10,11,12,13]
QUERY=
	SELECT
		DATETIME(SBAUTOLOCK_TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		AUTOLOCKTYPE AS "AUTO LOCK TYPE",
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		SBAUTOLOCK_ID AS "PLSPRINGBOARDAGENT_EVENTPOINT_SBAUTOLOCK TABLE ID" 
	FROM
	(
		SELECT
			SBAUTOLOCK_ID,
			SBAUTOLOCK_TIMESTAMP,
			TIME_OFFSET_TIMESTAMP,
			MAX(TIME_OFFSET_ID) AS MAX_ID,
			AUTOLOCKTYPE,
			SYSTEM
		FROM
		(
		SELECT
			PLSPRINGBOARDAGENT_EVENTPOINT_SBAUTOLOCK.TIMESTAMP AS SBAUTOLOCK_TIMESTAMP,
			AUTOLOCKTYPE,
			PLSPRINGBOARDAGENT_EVENTPOINT_SBAUTOLOCK.ID AS "SBAUTOLOCK_ID" ,
			PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
			PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
			PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
		FROM
			PLSPRINGBOARDAGENT_EVENTPOINT_SBAUTOLOCK
		LEFT JOIN
			PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
		)
		AS SBAUTOLOCK_STATE 
		GROUP BY
			SBAUTOLOCK_ID 
	)