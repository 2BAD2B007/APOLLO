[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Device/App Assertions

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=MACOS
VERSIONS=10.14,10.15

[Query Metadata]
QUERY_NAME=powerlog_assertion
ACTIVITY=Device/App Assertions
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 10.14,10.15]
QUERY=
	SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		ASSERTNAME AS 'ASSERT NAME',
		ACTION AS 'ACTION',
		ASSERTTYPE AS 'ASSERT TYPE',
		ASSERTIONONBEHALFOFPID AS 'ASSETION ON BEHALF OF PID',
		GLOBALUNIQUEID AS 'GLOBAL UNIQUE ID',
		TIMESTAMPACTIONOFFSET AS 'TIMESTAMP ACTION OFFSET',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		TIMESTAMPACTIONOFFSET,
		ACTION,
		ASSERTNAME,
		ASSERTTYPE,
		ASSERTIONONBEHALFOFPID,
		GLOBALUNIQUEID,
		SYSTEM
	FROM
	(
	SELECT
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.TIMESTAMP,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.TIMESTAMPACTIONOFFSET,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.ACTION,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.ASSERTNAME,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.ASSERTTYPE,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.ASSERTIONONBEHALFOFPID,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.GLOBALUNIQUEID,
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLPOWERASSERTIONAGENT_EVENTFORWARD_ASSERTION 
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )