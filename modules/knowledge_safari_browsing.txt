[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Safari browsing stored in the knowledgeC.db database

[Database Metadata]
DATABASE=knowledgeC.db
PLATFORM=IOS,MACOS
VERSIONS=11,12.13,10.13,10.14,10.15

[Query Metadata]
QUERY_NAME=knowledge_safari_browsing
ACTIVITY=Safari Browsing
KEY_TIMESTAMP=START


[SQL Query 11,12,13,10.13,10.14,10.15]
QUERY=
   SELECT
      DATETIME(ZOBJECT.ZSTARTDATE+978307200,'UNIXEPOCH') AS "START", 
      DATETIME(ZOBJECT.ZENDDATE+978307200,'UNIXEPOCH') AS "END",
      ZSTRUCTUREDMETADATA.Z_DKSAFARIHISTORYMETADATAKEY__TITLE AS "TITLE",
      ZOBJECT.ZVALUESTRING AS "URL", 
      ZSOURCE.ZBUNDLEID AS "BUNDLE ID",
	  ZSOURCE.ZGROUPID AS "GROUP  ID",
	  ZSOURCE.ZITEMID AS "ITEM ID",
	  ZSOURCE.ZSOURCEID AS "SOURCE ID",
      CASE ZOBJECT.ZSTARTDAYOFWEEK 
         WHEN "1" THEN "Sunday"
         WHEN "2" THEN "Monday"
         WHEN "3" THEN "Tuesday"
         WHEN "4" THEN "Wednesday"
         WHEN "5" THEN "Thursday"
         WHEN "6" THEN "Friday"
         WHEN "7" THEN "Saturday"
      END "DAY OF WEEK", 
      ZOBJECT.ZSECONDSFROMGMT/3600 AS "GMT OFFSET",
      DATETIME(ZOBJECT.ZCREATIONDATE+978307200,'UNIXEPOCH') AS "ENTRY CREATION",
      ZOBJECT.ZUUID AS "UUID", 
		ZSTRUCTUREDMETADATA.ZMETADATAHASH,
		ZOBJECT.Z_PK AS "ZOBJECT TABLE ID"
	FROM ZOBJECT
	      LEFT JOIN
         ZSTRUCTUREDMETADATA 
         ON ZOBJECT.ZSTRUCTUREDMETADATA = ZSTRUCTUREDMETADATA.Z_PK 
      LEFT JOIN
         ZSOURCE 
         ON ZOBJECT.ZSOURCE = ZSOURCE.Z_PK 
   WHERE
      ZSTREAMNAME IS "/safari/history"