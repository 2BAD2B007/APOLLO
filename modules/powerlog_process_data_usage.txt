[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Data Incoming/Outgoing to Devices 

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=IOS,MACOS
VERSIONS=9,10,11,12,13,10.14,10.15

[Query Metadata]
QUERY_NAME=powerlog_process_data_usage
ACTIVITY=Process Data Usage
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 9,10,11,12,13,10.14,10.15]
QUERY=
	SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		DATETIME(TIMESTAMPEND + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_END_TIMESTAMP,
		BUNDLENAME AS 'BUNDLE ID',
		PROCESSNAME AS 'PROCESS NAME',
		CELLIN AS 'CELL IN',
		CELLOUT AS 'CELL OUT',
		WIFIIN AS 'WIFI IN',
		WIFIOUT AS 'WIFI OUT',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		TIMESTAMPEND,
		BUNDLENAME,
		PROCESSNAME,
		CELLIN,
		CELLOUT,
		WIFIIN,
		WIFIOUT,
		SYSTEM
	FROM
	(
	SELECT
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.TIMESTAMP,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.TIMESTAMPEND,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.BUNDLENAME,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.PROCESSNAME,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.CELLIN,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.CELLOUT,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.WIFIIN,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.WIFIOUT,
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLPROCESSNETWORKAGENT_EVENTINTERVAL_USAGEDIFF 
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )