[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Power State, Sleep/Wake Status

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=MACOS
VERSIONS=10.14,10.15

[Query Metadata]
QUERY_NAME=powerlog_power_state
ACTIVITY=Power State
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 10.15]
QUERY=
	SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		DATETIME(TIMESTAMPLOGGED + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_LOGGED_TIMESTAMP,
		UUID AS 'UUID',
		REASON AS 'REASON',
		REASONVALUE AS 'REASON VALUE',
		WAKEREASON AS 'WAKE REASON',
		SLEEPTRIGGERS AS 'SLEEP TRIGGERS',
		STATE AS 'STATE',
		EVENT AS 'EVENT',
		WAKETRIGGERSUBCLASS AS 'WAKE TRIGGER SUBCLASS',
		CAPABILITIES AS 'CAPABILITIES',
		CURRENTKERNELWAKETIME AS 'CURRENT KERNEL WAKE TIME',
		DATETIME(KERNELSLEEPDATE, 'UNIXEPOCH') AS  'KERNEL SLEEP DATE',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		TIMESTAMPLOGGED,
		CAPABILITIES,
		CURRENTKERNELWAKETIME,
		EVENT,
		KERNELSLEEPDATE,
		REASON,
		SLEEPTRIGGERS,
		STATE,
		UUID,
		WAKETRIGGERSUBCLASS,
		REASONVALUE,
		WAKEREASON,
		SYSTEM
	FROM
	(
	SELECT
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.TIMESTAMP,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.TIMESTAMPLOGGED,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.CAPABILITIES,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.CURRENTKERNELWAKETIME,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.EVENT,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.KERNELSLEEPDATE,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.REASON,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.SLEEPTRIGGERS,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.STATE,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.UUID,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.WAKETRIGGERSUBCLASS,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_REASON.VALUE AS REASONVALUE,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_WAKETRIGGERSUBCLASS.VALUE AS WAKEREASON,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE 
		LEFT JOIN PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_REASON ON PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.ID == PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_REASON.FK_ID
		LEFT JOIN PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_WAKETRIGGERSUBCLASS ON PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.ID == PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_WAKETRIGGERSUBCLASS.FK_ID
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )

[SQL Query 10.14]
QUERY=
     SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		DATETIME(TIMESTAMPLOGGED + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_LOGGED_TIMESTAMP,
		UUID AS 'UUID',
		REASON AS 'REASON',
		REASONVALUE AS 'REASON VALUE',
		WAKEREASON AS 'WAKE REASON',
		STATE AS 'STATE',
		EVENT AS 'EVENT',
		WAKETRIGGERSUBCLASS AS 'WAKE TRIGGER SUBCLASS',
		CAPABILITIES AS 'CAPABILITIES',
		CURRENTKERNELWAKETIME AS 'CURRENT KERNEL WAKE TIME',
		DATETIME(KERNELSLEEPDATE, 'UNIXEPOCH') AS  'KERNEL SLEEP DATE',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		TIMESTAMPLOGGED,
		CAPABILITIES,
		CURRENTKERNELWAKETIME,
		EVENT,
		KERNELSLEEPDATE,
		REASON,
		STATE,
		UUID,
		WAKETRIGGERSUBCLASS,
		REASONVALUE,
		WAKEREASON,
		SYSTEM
	FROM
	(
	SELECT
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.TIMESTAMP,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.TIMESTAMPLOGGED,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.CAPABILITIES,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.CURRENTKERNELWAKETIME,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.EVENT,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.KERNELSLEEPDATE,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.REASON,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.STATE,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.UUID,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.WAKETRIGGERSUBCLASS,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_REASON.VALUE AS REASONVALUE,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_WAKETRIGGERSUBCLASS.VALUE AS WAKEREASON,
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE 
		LEFT JOIN PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_REASON ON PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.ID == PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_REASON.FK_ID
		LEFT JOIN PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_WAKETRIGGERSUBCLASS ON PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE.ID == PLSLEEPWAKEAGENT_EVENTFORWARD_POWERSTATE_ARRAY_WAKETRIGGERSUBCLASS.FK_ID
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )