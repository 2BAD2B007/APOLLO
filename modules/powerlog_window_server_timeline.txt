[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Window Server Agent Data

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=MACOS
VERSIONS=10.15

[Query Metadata]
QUERY_NAME=powerlog_window_server_timeline
ACTIVITY=Window Server Timeline
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 10.15]
QUERY=
	SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		DATETIME(TIMESTAMPLOGGED + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_LOGGED_TIMESTAMP,
		SESSIONID AS 'SESSION ID',
		PROCESSNAME AS 'PROCESS NAME',
		PID AS 'PID',
		WINDOWSOCCLUDED AS 'WINDOWS OCCLUDED',
		WINDOWSOFFSCREEN AS 'WINDOWS OFF SCREEN',
		WINDOWSORDEREDOUT AS 'WINDOWS ORDERED OUT',
		WINDOWSVISIBLE AS 'WINDOWS VISIBLE',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		TIMESTAMPLOGGED,
		SESSIONID,
		PROCESSNAME,
		PID,
		WINDOWSOCCLUDED,
		WINDOWSOFFSCREEN,
		WINDOWSORDEREDOUT,
		WINDOWSVISIBLE,
		SYSTEM
	FROM
	(
	SELECT
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.TIMESTAMP,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.TIMESTAMPLOGGED,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.SESSIONID,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.PROCESSNAME,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.PID,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.WINDOWSOCCLUDED,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.WINDOWSOFFSCREEN,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.WINDOWSORDEREDOUT,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.WINDOWSVISIBLE,
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLWINDOWSERVERAGENT_EVENTFORWARD_TIMELINEINFO 
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )