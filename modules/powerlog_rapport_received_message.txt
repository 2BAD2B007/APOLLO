[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Rapport Received Messages

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=MACOS
VERSIONS=10.15

[Query Metadata]
QUERY_NAME=powerlog_rapport_received_message
ACTIVITY=Rapport Received Message
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 10.15]
QUERY=
	SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		DATETIME(TIMESTAMPEND + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_END_TIMESTAMP,
		APPID AS 'APP ID',
		BYTES AS 'BYTES',
		IDENTIFIER AS 'IDENTIFIER',
		LINKTYPE AS 'LINK TYPE',
		MESSAGES AS 'MESSAGES',
		SENDERID AS 'SENDER ID',
		TYPE AS 'TYPE',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		TIMESTAMPEND,
		APPID,
		BYTES,
		IDENTIFIER,
		LINKTYPE,
		MESSAGES,
		SENDERID,
		TYPE,
		SYSTEM
	FROM
	(
	SELECT
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.TIMESTAMP,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.TIMESTAMPEND,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.APPID,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.BYTES,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.IDENTIFIER,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.LINKTYPE,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.MESSAGES,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.SENDERID,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.TYPE,
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLXPCAGENT_EVENTINTERVAL_RAPPORTRECEIVEDMESSAGE 
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )