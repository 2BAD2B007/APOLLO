[Module Metadata]
AUTHOR=Sarah Edwards/mac4n6.com/@iamevltwin
MODULE_NOTES=Push Messages Received

[Database Metadata]
DATABASE=CurrentPowerlog.PLSQL
PLATFORM=IOS,MACOS
VERSIONS=9,10,11,12,13.10.15

[Query Metadata]
QUERY_NAME=powerlog_push_message_received
ACTIVITY=Push Message Received
KEY_TIMESTAMP=ADJUSTED_TIMESTAMP

[SQL Query 9,10,11,12,13,10.15]
QUERY=
	SELECT
		DATETIME(TIMESTAMP + SYSTEM, 'UNIXEPOCH') AS ADJUSTED_TIMESTAMP,
		BUNDLEID AS 'BUNDLE ID',
		CONNECTIONTYPE AS 'CONNECTION TYPE',
		ISDROPPED AS 'IS DROPPED',
		LINKQUALITY AS 'LINK QUALITY',
		PRIORITY AS 'PRIORITY',
		TOPIC AS 'TOPIC',
		SERVERHOSTNAME AS 'SERVERHOSTNAME',
		SERVERIP AS 'SERVER IP',
		DATETIME(TIMESTAMP, 'UNIXEPOCH') AS ORIGINAL_TIMESTAMP,
		DATETIME(TIME_OFFSET_TIMESTAMP, 'UNIXEPOCH') AS OFFSET_TIMESTAMP,
		SYSTEM AS TIME_OFFSET,
		TABLE_ID AS "PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH TABLE ID"
	FROM
	(
	SELECT
		TABLE_ID,
		TIMESTAMP,
		TIME_OFFSET_TIMESTAMP,
		MAX(TIME_OFFSET_ID) AS MAX_ID,
		BUNDLEID,
		CONNECTIONTYPE,
		ISDROPPED,
		LINKQUALITY,
		PRIORITY,
		TOPIC,
		SERVERHOSTNAME,
		SERVERIP,
		SYSTEM
	FROM
	(
	SELECT
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.TIMESTAMP,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.BUNDLEID,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.CONNECTIONTYPE,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.ISDROPPED,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.LINKQUALITY,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.PRIORITY,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.TOPIC,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.SERVERHOSTNAME,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.SERVERIP,
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH.ID AS "TABLE_ID",
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.TIMESTAMP AS TIME_OFFSET_TIMESTAMP,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.ID AS TIME_OFFSET_ID,
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET.SYSTEM
	FROM
		PLPUSHAGENT_EVENTPOINT_RECEIVEDPUSH 
	LEFT JOIN
		PLSTORAGEOPERATOR_EVENTFORWARD_TIMEOFFSET 
	)
	GROUP BY
	TABLE_ID 
         )